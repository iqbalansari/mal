(defpackage :utils
  (:use :common-lisp
        :uiop)
  (:export :replace-all
           :getenv
           :read-file-string
           :raw-command-line-arguments
           :listify))

(in-package :utils)

(defun replace-all (string part replacement &key (test #'char=))
  "Returns a new string in which all the occurences of the part
is replaced with replacement."
  (with-output-to-string (out)
    (loop with part-length = (length part)
       for old-pos = 0 then (+ pos part-length)
       for pos = (search part string
                         :start2 old-pos
                         :test test)
       do (write-string string out
                        :start old-pos
                        :end (or pos (length string)))
       when pos do (write-string replacement out)
       while pos)))

(defun listify (sequence)
  "Convert a sequence to a list"
  (map 'list #'identity sequence))
